<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Windows Server 2019搭建NAS - sh1marin's Blog</title>
<meta name=description content="Windows Server 2019搭建NAS的一些总结 前言 前几天心血来潮想要搭建NAS，尝试在Windows Server 2019上搭建，经过30多个小时的折腾以后，被Win">
<meta name=author content>
<link rel="preload stylesheet" as=style href=https://blog.sh1mar.in/app.min.css>
<link rel="preload stylesheet" as=style href=https://blog.sh1mar.in/an-old-hope.min.css>
<script defer src=https://blog.sh1mar.in/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://blog.sh1mar.in/theme.png>
<link rel=preload as=image href=https://blog.sh1mar.in/twitter.svg>
<link rel=preload as=image href=https://blog.sh1mar.in/github.svg>
<link rel=icon href=https://blog.sh1mar.in/favicon.ico>
<link rel=apple-touch-icon href=https://blog.sh1mar.in/apple-touch-icon.png>
<meta name=generator content="Hugo 0.91.2">
<meta property="og:title" content="Windows Server 2019搭建NAS">
<meta property="og:description" content="Windows Server 2019搭建NAS的一些总结 前言 前几天心血来潮想要搭建NAS，尝试在Windows Server 2019上搭建，经过30多个小时的折腾以后，被Win">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.sh1mar.in/post/tools/windows-server-2019%E6%90%AD%E5%BB%BAnas%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2019-05-11T00:00:00+00:00">
<meta property="article:modified_time" content="2019-05-11T00:00:00+00:00">
<meta itemprop=name content="Windows Server 2019搭建NAS">
<meta itemprop=description content="Windows Server 2019搭建NAS的一些总结 前言 前几天心血来潮想要搭建NAS，尝试在Windows Server 2019上搭建，经过30多个小时的折腾以后，被Win"><meta itemprop=datePublished content="2019-05-11T00:00:00+00:00">
<meta itemprop=dateModified content="2019-05-11T00:00:00+00:00">
<meta itemprop=wordCount content="4681">
<meta itemprop=keywords content="nas,windos,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Windows Server 2019搭建NAS">
<meta name=twitter:description content="Windows Server 2019搭建NAS的一些总结 前言 前几天心血来潮想要搭建NAS，尝试在Windows Server 2019上搭建，经过30多个小时的折腾以后，被Win">
</head>
<body class=not-ready data-menu=false>
<header class=header>
<p class=logo>
<a class=site-name href=https://blog.sh1mar.in>sh1marin's Blog</a><a class=btn-dark></a>
</p>
<script>let bodyClx=document.body.classList,btnDark=document.querySelector('.btn-dark'),sysDark=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark'),setDark=a=>{bodyClx[a?'add':'remove']('dark'),localStorage.setItem('dark',a?'yes':'no')};setDark(darkVal?darkVal==='yes':sysDark.matches),requestAnimationFrame(()=>bodyClx.remove('not-ready')),btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark'))),sysDark.addEventListener('change',a=>setDark(a.matches))</script>
<nav class=social>
<a class=twitter style=--url:url(./twitter.svg) href=https://twitter.com/twitter.com/sh1ma_rin target=_blank></a>
<a class=github style=--url:url(./github.svg) href=https://github.com/github.com/Avimitin target=_blank></a>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-title>
<p>
<time>May 11, 2019</time>
</p>
<h1>Windows Server 2019搭建NAS</h1>
</header>
<section class=post-content><h1 id=windows-server-2019搭建nas的一些总结>Windows Server 2019搭建NAS的一些总结</h1>
<h2 id=前言>前言</h2>
<p>前几天心血来潮想要搭建NAS，尝试在Windows Server 2019上搭建，经过30多个小时的折腾以后，被Windows的防火墙，文件权限和账户管理弄到崩溃；被Linux的众多命令和软件迭代浪费不少时间。谷歌了不少资料和文档，发现没有见到过完整的，能够手把手教学的NAS搭建教学和问题总结，走了不少弯路，有些问题到现在都还没有解决。所以为了方便自己之后的检索和其他入门朋友的学习，我把自己看的资料给整理摘录起来，并且记录一些经验。
总结分Windows Server（半成品，大多为失败的经验）和Ubuntu（完成度已经满足个人需求）两个环境，如果你是Linux平台使用者请看我下一篇文章。</p>
<hr>
<blockquote>
<p>Windows Server 2019 环境下NAS搭建问题总结</p>
</blockquote>
<p>我对NAS的要求是这样的：</p>
<blockquote>
<ul>
<li>SAMBA共享，做一个本地云盘，身边移动设备随时拷贝设备。</li>
<li>离线下载机，通过web管理任务。</li>
<li>家庭影院站点。</li>
<li>全WEB管理，不需要额外管理硬件（不用外接显示器鼠标键盘）</li>
</ul>
</blockquote>
<p>那么就先从系统搭建开始，黑群晖是不会去考虑的了，又不可靠也不方便，折腾起来要人命。于是就在Windows Server和Linux之间选择。考虑着自己是小白，而且已经习惯了Windows的交互方式，所以一开始选择了Windows Server（以下简称WS）。</p>
<hr>
<h2 id=那么就开始ws的安装>那么就开始WS的安装</h2>
<p><del>(心态崩溃的说，我觉得直接用Win10搭建更省力。)</del></p>
<p>先从<a href=http://msdn.itellyou.cn/>MSDN</a>上下载了WS2019【ed2k链接得用迅雷下载嗷】。</p>
<p>下载完之后用<a href=https://www.ultraiso.com/download.html>UltraISO</a>烧录进U盘。</p>
<p>然后点击工具栏的启动，选择 <strong>写入硬盘映像</strong> 。</p>
<p>写入完成以后重启，按F12（看你的系统boot选项），选择U盘安装，其余步骤就自己选择，不在这里细讲</p>
<p><strong>注意：最好选择带有桌面体验的版本，不然进去就是PowerShell配置，满屏命令让你怀疑人生。</strong></p>
<hr>
<h2 id=windows-server初步配置1>Windows Server初步配置[1]</h2>
<p>系统安装好以后首先第一步是要处理账户问题，对于一台NAS机来说首先最重要的就是摁下开机键马上就开始工作，所以免密登陆是必要的。</p>
<p>我们用
<code>Win+R运行gpedit.msc</code>打开组策略编辑器，找到 <strong>计算机配置-Windows设置-安全设置-账户策略-密码策略</strong> 中，把 <strong>密码必须符合复杂性</strong> 要求禁用。然后去 <strong>控制面板-用户账户</strong> 中输入当前密码， <strong>新密码留空</strong> ，确认后就把密码取消了。</p>
<p>虽然取消了密码，但是开机还需要按<strong>Ctrl+Alt+Del</strong> ，来开机，这个时候就需要进行账户配置。我们需要进入系统后，按Win+R键打开[运行]，输入<strong>secpol.msc</strong>回车打开 <strong>[本地安全策略-本地策略-安全选项]</strong> 找到 <strong>[交互式登录:无须按Crtl+Alt+Del]</strong> 并双击打开设为启用。</p>
<p>顺便到下面找到并禁用 <strong>[账户:使用空密码的本地账户只允许进行控制台登录]</strong> ，以便在远程登陆时能够成功免密码登录，</p>
<p>为了让开机直接能够进入系统，不需要任何操作，我们还需要进行一步。通过 <code>**Win+R[运行]control userpasswords2** </code>，从而打开 <strong>[本地用户账户设置]</strong> ，取消勾选**[要使用本机，用户必须输入用户名和密码]**并确认。</p>
<p>重启之后对账户进行修改，打开 <strong>[服务器管理器-本地服务器]</strong> 点击计算机名，可以直接在弹窗中更改你的 <strong>计算机描述 ，<strong>点击下面的</strong>更改</strong>进入二级选单，更改计算机名为“你的名字”，这里防止冲突<strong>不推荐</strong>把计算机名和管理员名设置成相同的，最好能使用两个独立的名字。</p>
<p>确认之后执行<code>Win+R[运行]compmgmt.msc</code>打开 <strong>[计算机管理-系统工具-本地用户和组-用户]</strong> ，找到Administrator右键[重命名]为你的名字。然后双击打开Guest用户，选择 <strong>账户已禁用</strong> ，然后重启试试，就可以直接进入桌面了。<strong>(请注意，之后如果有登录需要密码的选项就回来重复这一步)</strong></p>
<p>这样关于WS的账户配置就初步完成了。</p>
<hr>
<h2 id=服务器配置2>服务器配置[2]</h2>
<p>打开磁贴里的 <strong>服务器管理器</strong> ，右上角选择 <strong>角色与服务</strong>，到 <strong>服务器角色</strong> 页面，勾选上 <strong>Hyper-V ，iSCSI</strong>。接下来就是一直下一步。</p>
<p>等配置完成之后，重启，开始 Windows Update，下载必要更新和驱动。</p>
<p><strong>#此处我遇到了第一个问题：官方驱动更新时间非常的旧，普通的驱动精灵驱动人生无法安装。解决的办法是：通过设备管理器识别硬件名，去各个硬件厂商官网搜索驱动自行安装。</strong></p>
<p><strong>比如我就遇到一个问题：网卡驱动过老，没有千兆全双工，百兆下文件传输只有12M/s左右的速度。后来去<a href=https://realtek-download.com/realtek-pcie-gbe-family-controller/>Realtek</a>的一个unofficial 网站搜了半天才找到这个网卡的驱动。</strong></p>
<p><strong>安装驱动时我又遇到一个问题，我的GT1030显卡无法识别，Geforce安装打开会出现缺少<a href=https://shiyousan.com/post/636198377099365244>Wlanapi.dll</a>文件，这个就去添加角色与服务选项中，选择无线LAN服务，就可以安装上这dll文件了。</strong></p>
<hr>
<p>驱动安装完成以后就可以正式开始配置了，首先要解决IE浏览器的安全管理，在**[服务器管理器]-[本地服务器]**中点击IE增强的安全配置，把里面的两项都禁用就可以了。然后就可以打开IE下载<a href=https://www.google.cn/chrome/index.html>Chrome</a>了。/斜眼笑</p>
<p>然后就是最重要的文件共享了。这里我选择的是SMB服务。<strong>#多讲一句，如果你只有上传下载文件的需求，其实也可以选择FTP，FTP的上传下载速度相对会更快，但是为了实时编辑文件和在线播放NAS里的文件，我选择了SAMBA。</strong></p>
<p>在创建之前，在设置中的网络与Internet页面确认你是不是<strong>专用网络</strong>类型，如果是公用的话就改回专用。然后打开网络和共享中心，选择高级网络选项，在专用网络处选择**[启用网络发现]<strong>和子选项</strong>[启用网络设备的自动连接设置]<strong>，以及下面的</strong>[启用文件和打印机共享]**。</p>
<p>** 此处注意，假如遇到登录需要凭证，然后密码一直输入不正确的情况请重新执行这个步骤，然后把底下的需要密码选项关闭。**</p>
<h2 id=samba文件共享设置3>SAMBA文件共享设置[3]</h2>
<p>打开**[服务器管理]-[文件存储服务]-[共享]**，点击创建。</p>
<p>选择[SMB共享-快速]，在下一页选择自己要共享的硬盘，因为我是SSD+HDD，所以就直接选择机械硬盘，然后为了之后方便访问，<strong>选择自定义路径D:***（你要分享的文件夹）</strong>，再下一步写上自己喜欢的名字以后，勾选上**[允许共享缓存]**，继续下一步。</p>
<blockquote>
<p><strong>然后就到了最令人窒息的一步了，这里没有做好你会陷入无法访问和权利不够的报错中，然后自闭。</strong></p>
</blockquote>
<p>在权限栏里，点击**[自定义权限]<strong>，在弹窗中点击</strong>[共享-添加-选择主体]<strong>。输入你上次输入的管理员的名字，把</strong>完全控制选项**钩上，然后确认-创建。</p>
<p>这个时候用你的另一台win设备打开网络查看是否有共享的文件夹。</p>
<blockquote>
<h4 id=说一下这里我遇到的几个问题>说一下这里我遇到的几个问题</h4>
<blockquote>
<ul>
<li>首先第一个遇到的是有的电脑无法连接，显示无权访问。这个的话先检查管理员权限是否给够了，然后检查共享设置处的权限是否有添加你的管理员。最后请检查拼写错误。（建议使用右边自带的检查名称选项补全）</li>
<li>假如你的局域网内就你一人，或者你想开放NAS给局域网内的用户，可以把everyone的权限给满，并在权限选项卡添加everyone用户。这样每一台你局域网内的用户都能随时连上去。</li>
<li>有时候你重启NAS以后，再用其他设备打开共享文件夹要求输入密码，但是你又没有密码，然后就卡在登陆界面了。这个问题在高级共享里可以解决，打开**[网络与共享中心]-[高级共享设置]**，选择所有网络选项卡，勾选最底下的[不需要密码登陆]。<em>ps：这个问题折磨死我了，谷歌根本找不到答案，我还是按照别人的步骤一步一步排查才找到的。</em></li>
<li>成功打开共享文件夹以后尝试拖动文件进去NAS，可能有的人会特别慢，像我之前10M/s</li>
<li>假如遇到上传下载速度特别慢的，请按照我列下的清单排查。</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1.连线的两台设备是否是千兆网卡。</strong>（技巧：你的网卡是否带GBE字样，GBE网卡基本皆为千兆卡。</p>
</li>
<li>
<p><strong>2.路由器是否支持千兆网络。</strong></p>
</li>
<li>
<p><strong>3.是否使用超六类网线将设备与路由器连接。</strong></p>
</li>
<li>
<p><strong>4.如果是使用WLAN的用户请确认你的WLAN适配器是否支持千兆。</strong></p>
</li>
<li>
<p><strong>5.如果确认都没有问题请打开设置-网络，查看你的网络属性，检查网络是否在千兆工作模式下。</strong></p>
</li>
<li>
<p><strong>6.假如是5提出的问题，左下角开始键，右键设备管理器，右键你的网络设备-属性，点击[高级]选项卡，属性选项栏里选择[连接速度和工作模式]，设置为1Gbps和全双工模式。</strong></p>
</li>
<li>
<p><strong>7.假如无法使用6来解决5的问题请检查驱动或者卸载设备再挂载。</strong></p>
</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<p>[1].[2].[3].参考文献：极客湾NAS搭建教程一、二、三<code>https://mp.weixin.qq.com/s/9JJJDoluZcul5khXtfIlOQ</code></p>
<hr>
<h2 id=家庭影院的设置>家庭影院的设置</h2>
<p>之所以费功夫去配置SAMBA就是因为在这个共享模式下很多视频播放软件可以直接局域网内播放硬盘视频，比如<a href=https://www.plex.tv/>Plex</a>啊，<a href=https://emby.media/>Emby</a>啊。开机设置后台自启动，配置一下路径，甚至可以直接识别图片和分类。还有节目单和电影imdb评分细节，跟一个普通的流媒体软件差不多强大好用。具体怎么配置官网有中文教程的了。</p>
<p>我这里安利另外一个软件，nplayer。有lite和付费版。lite的广告多到让你自闭，付费版30元买断。这个播放器非常非常强大，首先通用的本地服务器协议基本都支持，包括FTP等协议。第二就是各大网盘，什么OneDrive啊Google Drive啊，通通都支持。然后就是他也支持封面页搜索和外挂字幕，还支持DTS音效。虽然功能比较简单粗暴但是好用精制，对于局域网播放来说是非常好用的一个软件。也不需要在NAS上安装多余的软件。</p>
<p>离线下载的话，现在bt下载我是用<a href=https://transmissionbt.com/>Transmission</a>，离线下载用<a href=https://aria2.github.io/>Aria2</a>，具体配置看的是<a href=https://zhuanlan.zhihu.com/p/30666881>这篇文章</a>。这两个软件均有web管理，可以局域网远程管理下载任务。尽量别用迅雷，迅雷除了下载ed2k链接，其他功能都可以被替代，而且非会员还限速。</p>
<hr>
<h2 id=远程管理的设置和疑惑>远程管理的设置和疑惑</h2>
<p>之所以把这么重要的环节放到最后，主要还是在配置远程管理的时候我出现了很多令人崩溃的问题。所以以下为我的失败经验记录和感慨</p>
<blockquote>
<p>首先介绍一下远程管理的思路</p>
<blockquote>
<p>1.远程桌面控制：<a href=https://www.teamviewer.com/cn/>Teamviewer</a>，不过多介绍了，老牌软件，实力多强劲应该都知道。主要也方便。</p>
<p>2.远程web管理：<a href=https://docs.microsoft.com/en-us/windows-server/manage/windows-admin-center/understand/windows-admin-center>Windows Admin Center</a>，很好用很精美但是也是我放弃WS平台的一个直接原因。</p>
</blockquote>
</blockquote>
<p>先来讲一下我的想法，我的希望是对NAS的管理能够轻量化，我不希望去配置远程桌面来，说实话远程桌面给人臃肿的感觉，假如有一个平台可以用图形选项管理系统就好了。</p>
<p>然后我就了解到这个Windows Admin Center（下面简称WAC）。</p>
<p>因为对于NAS来说稳定是最重要的，怎样最稳定呢？就是对他不要有任何改动的时候最稳定，所以有这么一个轻型平台可以检查报错和维护，简直不要太舒服。</p>
<p>一开始我也是这么想的。然后我就被WS的防火墙和权限搞崩溃了。本地链接/localhost:6516，可以上得去，然后点开，显示我权限不足。然而我还只是在本地打开web页面而已，于是我就打开本地组策略管理，发现guest用户自动打开了，于是我封锁guest账户。成功在本地打开web管理。</p>
<p>然而等我用其他机器浏览器输入/ip#NAS的IP/6516，却总是打不开页面。于是我打开防火墙，出站和入站规则增加6516端口的规则，把6516端口打开。</p>
<p>这一次能登得上了，但是打开NAS的控制界面时却出现了403Forbidden。排除掉所有可能的黑名单和权限以后还是打不开。</p>
<p>然后偶然间我再登陆了一下transmission的web管理界面，也被403 Forbidden了，我打开transmission的页面，关闭白名单模式，403；打开白名单并加入管理端主机ip，还是403。</p>
<p>这两个问题排查了1个小时以后，还是没有解决，于是我决定放弃WS平台，转投Linux。</p>
<h2 id=希望以上成功的折腾经历可以给你们一些经验上的帮助>希望以上成功的折腾经历可以给你们一些经验上的帮助。</h2>
</section>
<footer class=post-tags>
<a href=https://blog.sh1mar.in/tags/nas>nas</a>
<a href=https://blog.sh1mar.in/tags/windos>windos</a>
</footer>
<nav class=post-nav>
<a class=prev href=https://blog.sh1mar.in/post/linux/%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%8B%E7%8E%A9minecraft/><span>←</span><span>在Linux系统下玩Minecraft</span></a>
<a class=next href=https://blog.sh1mar.in/post/security/canokeys/><span>Canokeys and GPG</span><span>→</span></a>
</nav>
</article>
</main>
<footer class=footer>
<p>&copy; 2022 <a href=https://blog.sh1mar.in>sh1marin's Blog</a></p>
<p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p>
<p>
<a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a>
</p>
</footer>
</body>
</html>